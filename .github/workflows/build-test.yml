name: Build and Test

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: |
        if [ -f "package.json" ]; then
          npm ci
        else
          echo "No package.json found, skipping npm install"
        fi
        
    - name: Validate project structure
      run: |
        echo "üîç Validating project structure..."
        
        # Check HTML
        if [ -f "index.html" ]; then
          echo "‚úÖ index.html found"
          # Basic HTML validation
          if grep -q "<!DOCTYPE html>" index.html; then
            echo "‚úÖ Valid HTML5 doctype"
          else
            echo "‚ö†Ô∏è HTML5 doctype not found"
          fi
        else
          echo "‚ùå index.html not found"
          exit 1
        fi
        
        # Check CSS
        if [ -f "style.css" ]; then
          echo "‚úÖ style.css found"
          # Check if CSS is not empty
          if [ -s "style.css" ]; then
            echo "‚úÖ CSS file has content"
          else
            echo "‚ö†Ô∏è CSS file is empty"
          fi
        else
          echo "‚ùå style.css not found"
          exit 1
        fi
        
        # Check JavaScript
        if [ -f "contact-sharer.js" ]; then
          echo "‚úÖ contact-sharer.js found"
          # Basic JS validation
          if grep -q "class ContactSharer" contact-sharer.js; then
            echo "‚úÖ ContactSharer class found"
          else
            echo "‚ö†Ô∏è ContactSharer class not found"
          fi
        else
          echo "‚ùå contact-sharer.js not found"
          exit 1
        fi
        
        # Check Vercel config
        if [ -f "vercel.json" ]; then
          echo "‚úÖ vercel.json found"
        else
          echo "‚ö†Ô∏è vercel.json not found"
        fi
        
        # Check image
        if [ -f "imagenpro-2.png" ]; then
          echo "‚úÖ Profile image found"
        else
          echo "‚ö†Ô∏è Profile image not found"
        fi
        
        # Check documentation
        if [ -f "README.md" ]; then
          echo "‚úÖ README.md found"
        else
          echo "‚ö†Ô∏è README.md not found"
        fi
        
        echo "üéâ Project structure validation completed!"
        
    - name: Test HTML validity
      run: |
        echo "üîç Testing HTML structure..."
        
        # Check for required meta tags
        if grep -q '<meta charset="UTF-8">' index.html; then
          echo "‚úÖ Charset meta tag found"
        else
          echo "‚ö†Ô∏è Charset meta tag missing"
        fi
        
        if grep -q '<meta name="viewport"' index.html; then
          echo "‚úÖ Viewport meta tag found"
        else
          echo "‚ö†Ô∏è Viewport meta tag missing"
        fi
        
        # Check for required elements
        if grep -q '<title>' index.html; then
          echo "‚úÖ Title tag found"
        else
          echo "‚ùå Title tag missing"
          exit 1
        fi
        
        echo "‚úÖ HTML validation completed!"
        
    - name: Test CSS validity
      run: |
        echo "üîç Testing CSS structure..."
        
        # Check for basic CSS structure
        if grep -q "body {" style.css; then
          echo "‚úÖ Body styles found"
        else
          echo "‚ö†Ô∏è Body styles not found"
        fi
        
        if grep -q ".card {" style.css; then
          echo "‚úÖ Card styles found"
        else
          echo "‚ö†Ô∏è Card styles not found"
        fi
        
        if grep -q ".share-btn {" style.css; then
          echo "‚úÖ Button styles found"
        else
          echo "‚ö†Ô∏è Button styles not found"
        fi
        
        echo "‚úÖ CSS validation completed!"
        
    - name: Test JavaScript validity
      run: |
        echo "üîç Testing JavaScript structure..."
        
        # Check for basic JS structure
        if grep -q "class ContactSharer" contact-sharer.js; then
          echo "‚úÖ ContactSharer class found"
        else
          echo "‚ùå ContactSharer class missing"
          exit 1
        fi
        
        if grep -q "init()" contact-sharer.js; then
          echo "‚úÖ Init method found"
        else
          echo "‚ö†Ô∏è Init method not found"
        fi
        
        echo "‚úÖ JavaScript validation completed!"
        
    - name: Generate deployment report
      run: |
        echo "üìä Deployment Report" > deployment-report.txt
        echo "===================" >> deployment-report.txt
        echo "Date: $(date)" >> deployment-report.txt
        echo "Commit: ${{ github.sha }}" >> deployment-report.txt
        echo "Branch: ${{ github.ref_name }}" >> deployment-report.txt
        echo "" >> deployment-report.txt
        echo "Files checked:" >> deployment-report.txt
        echo "- index.html ‚úÖ" >> deployment-report.txt
        echo "- style.css ‚úÖ" >> deployment-report.txt
        echo "- contact-sharer.js ‚úÖ" >> deployment-report.txt
        echo "- vercel.json ‚úÖ" >> deployment-report.txt
        echo "" >> deployment-report.txt
        echo "Ready for deployment! üöÄ" >> deployment-report.txt
        
        cat deployment-report.txt
        
    - name: Success message
      run: |
        echo "üéâ Build successful!"
        echo "Your contact card is ready for deployment."
        echo "To deploy to Vercel, run: vercel --prod"
